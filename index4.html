<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Lecteur Torrent Web</title>
  <script src="https://cdn.jsdelivr.net/npm/webtorrent@latest/webtorrent.min.js"></script>
  <style>
    body { font-family: sans-serif; background: #111; color: white; text-align: center; padding: 2rem; }
    input, button { padding: 10px; font-size: 1rem; width: 60%; margin: 1rem 0; }
    video { width: 90%; max-width: 900px; margin-top: 2rem; border: 2px solid white; border-radius: 10px; }
    progress { width: 80%; height: 20px; }
  </style>
</head>
<body>
  <h1>üé¨ Lire un film via magnet</h1>
  <input id="magnet" placeholder="Colle ici le lien magnet..." />
  <br>
  <button onclick="play()">‚ñ∂Ô∏è Lancer la lecture</button>
  <p id="status">En attente...</p>
  <progress id="bar" value="0" max="100"></progress>
  <video id="video" controls autoplay></video>

  <script>
    const client = new WebTorrent();
    const status = document.getElementById("status");
    const progress = document.getElementById("bar");
    const video = document.getElementById("video");

    function play() {
      const magnet = document.getElementById("magnet").value.trim();
      if (!magnet.startsWith("magnet:?")) {
        status.textContent = "‚ùå Lien magnet invalide";
        return;
      }

      status.textContent = "‚è≥ Chargement du torrent...";
      client.add(magnet, (torrent) => {
        const file = torrent.files.find(f => /\.(mp4|mkv|webm)$/i.test(f.name));
        if (!file) {
          status.textContent = "‚ùå Aucun fichier vid√©o d√©tect√©.";
          console.log("Fichiers dans le torrent :", torrent.files.map(f => f.name));
          return;
        }

        status.textContent = `üé• Lecture de : ${file.name}`;
        file.renderTo(video);

        torrent.on("download", () => {
          const percent = (torrent.progress * 100).toFixed(1);
          status.textContent = `üì¶ T√©l√©charg√© : ${percent}%`;
          progress.value = percent;
        });

        torrent.on("done", () => {
          status.textContent = "‚úÖ T√©l√©chargement termin√©";
          progress.value = 100;
        });
      });
    }
  </script>
</body>
</html>
